<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Jadwal Ecare - Richard</title>

<style>
body{
    font-family: Arial, sans-serif;
    background:#f4f6f9;
    margin:20px;
}

.header{
    background:#1f2d3d;
    color:white;
    padding:15px;
    border-radius:8px;
}

textarea{
    width:100%;
    height:70px;
    margin-top:10px;
    padding:8px;
}

button{
    margin-top:10px;
    padding:8px 15px;
    background:#c0392b;
    color:white;
    border:none;
    cursor:pointer;
}

select{
    padding:6px;
    margin-right:10px;
}

table{
    width:100%;
    border-collapse: collapse;
    margin-top:20px;
    background:white;
}

th{
    background:#c0392b;
    color:white;
    padding:8px;
}

td{
    padding:6px;
    border:1px solid #ddd;
    text-align:center;
    font-size:13px;
}

.libur{
    background:#27ae60;
    color:white;
    font-weight:bold;
}
</style>
</head>
<body>

<div class="header">
<h2>RICHARD TRYAS SEMBIRING</h2>
REGULER | BDG | IG DM FIXED | WFO | NIK: 25286329
</div>

<h3>Paste Jadwal dari Sistem</h3>

<textarea id="pasteData" placeholder="Paste 1 baris jadwal di sini..."></textarea>
<br>
<button onclick="prosesPaste()">Simpan Otomatis</button>

<h3>Lihat Jadwal</h3>

<label>Bulan:</label>
<select id="bulan" onchange="filterData()">
<option value="01">Januari</option>
<option value="02" selected>Februari</option>
<option value="03">Maret</option>
<option value="04">April</option>
</select>

<label>Tanggal:</label>
<select id="tanggal" onchange="filterData()"></select>

<table>
<thead>
<tr>
<th>Tanggal</th>
<th>Kode</th>
<th>Masuk</th>
<th>Pulang</th>
<th>Istirahat 1</th>
<th>Istirahat 2</th>
<th>Istirahat 3</th>
<th>Status</th>
</tr>
</thead>
<tbody id="jadwalBody"></tbody>
</table>

<script>

const API_URL = "https://script.google.com/macros/s/AKfycbxDmLSACmGNet-OJn-FhfcHv6kX_GbSC8sDnhff6Tq5S5woJjXKgzSe0azrqbCC9HNR/exec";

async function prosesPaste(){

let text = document.getElementById("pasteData").value.trim();

if(!text){
    alert("Paste dulu datanya!");
    return;
}

// Pisah berdasarkan TAB
let data = text.split("\t");

let tanggalFull = data[0];
let kode = data[1];
let masuk = data[3];
let pulang = data[4];
let i1 = data[5];
let i2 = data[6];
let i3 = data[7];

// Ambil tanggal (format YYYY-MM-DD)
let parts = tanggalFull.split(" ");
let tgl = parts[0];
let bulanNama = parts[1];
let tahun = parts[2];

let bulanMap = {
"Januari":"01","Februari":"02","Maret":"03","April":"04",
"Mei":"05","Juni":"06","Juli":"07","Agustus":"08",
"September":"09","Oktober":"10","November":"11","Desember":"12"
};

let bulanAngka = bulanMap[bulanNama];
let tanggalKey = tahun + "-" + bulanAngka + "-" + tgl.padStart(2,'0');

// Kirim ke Google Sheet
await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({
        tanggal: tanggalKey,
        kode: kode,
        masuk: masuk,
        pulang: pulang,
        i1: i1,
        i2: i2,
        i3: i3
    })
});

document.getElementById("pasteData").value = "";

alert("Data berhasil disimpan!");
filterData();
}

function isiTanggal(){
let tanggalSelect = document.getElementById("tanggal");
tanggalSelect.innerHTML = "";

for(let i=1;i<=31;i++){
    let opt = document.createElement("option");
    opt.value = i.toString().padStart(2,'0');
    opt.text = i;
    tanggalSelect.appendChild(opt);
}
}

async function filterData(){

let bulan = document.getElementById("bulan").value;
let tanggal = document.getElementById("tanggal").value;
let body = document.getElementById("jadwalBody");
body.innerHTML = "";

let key = "2026-" + bulan + "-" + tanggal;

// Ambil semua data dari Sheet
let res = await fetch(API_URL);
let data = await res.json();

// Buang header
data.shift();

let ditemukan = false;

data.forEach(row => {
    if(row[0] === key){
        ditemukan = true;
        body.innerHTML = `
        <tr>
        <td>${row[0]}</td>
        <td>${row[1]}</td>
        <td>${row[2]}</td>
        <td>${row[3]}</td>
        <td>${row[4]}</td>
        <td>${row[5]}</td>
        <td>${row[6]}</td>
        <td>Masuk</td>
        </tr>`;
    }
});

if(!ditemukan){
    body.innerHTML = `
    <tr>
    <td>${key}</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
    <td class="libur">LIBUR</td>
    </tr>`;
}
}

isiTanggal();
filterData();

</script>

</body>
</html>
    
